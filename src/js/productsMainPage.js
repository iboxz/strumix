gsap.registerPlugin(ScrollTrigger,ScrollSmoother,SplitText);const smoother=ScrollSmoother.create({wrapper:"#smooth-wrapper",content:"#smooth-content",smooth:.4,effects:!0,smoothTouch:!1});navigator.userAgent.match(/iPhone/i)||gsap.from(new SplitText(".hero > p:nth-child(2)",{type:"chars",tagName:"span",tag:"span"}).chars,{delay:2.5,opacity:.2,duration:.5,ease:"power3.out",stagger:.15});const productList=document.querySelector(".productList"),bottomSectionContainer=document.getElementById("bottomSection");let data=null;const fetchData=async()=>{if(!data)try{const today=new Date,version=`${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2,"0")}${today.getDate().toString().padStart(2,"0")}`;data=await(await fetch(`../serverAssets/products.json?version=${version}`)).json()}catch(error){console.error("Error fetching data:",error)}return data},searchProduct=async productName=>{const bottomSectionContainer=document.getElementById("bottomSection"),productList=document.querySelector(".productList");smoother.scrollTo(bottomSectionContainer,!0,"bottom top");const data=await fetchData();if(data){const foundProducts=findProductsByName(data,productName);displaySearchResults(foundProducts,productList)}},findProductsByName=(data,productName)=>{const foundProducts=[];for(const category of data.categories)for(const product of category.products){const productNameFa=product.name.fa.toLowerCase(),productNameEn=product.name.en.toLowerCase();(productNameFa.includes(productName.toLowerCase())||productNameEn.includes(productName.toLowerCase()))&&foundProducts.push(product)}return foundProducts},displaySearchResults=(products,productList)=>{if(productList.innerHTML="",products.length>0)for(const product of products){const div=document.createElement("div");div.setAttribute("data-cursor","pointerLinkNavbar");const link=document.createElement("a");link.href=`${product.url}`;const img=document.createElement("img");img.src=`../assets/productImg/${product.image}`,img.alt=`${product.name.en} image, تصویر ${product.name.fa}`,img.setAttribute("loading","lazy"),link.appendChild(img),[product.name.en,product.name.fa].forEach(name=>{const p=document.createElement("p");p.className="englishText",p.textContent=name,link.appendChild(p)}),div.appendChild(link),productList.appendChild(div),activateCustomCursors()}else productList.textContent="محصولی یافت نشد";const counter=document.querySelector(".counter");counter.textContent=`${products.length} محصول`},renderAllProducts=async()=>{const data=await fetchData();if(data){productList.innerHTML="";let allProducts=[],buttons;document.querySelectorAll(".selection .buttonCards").forEach(button=>button.classList.remove("active")),document.getElementById("allProducts").classList.add("active"),data.categories.forEach(category=>{allProducts=allProducts.concat(category.products)}),displaySearchResults(allProducts,productList)}};document.addEventListener("DOMContentLoaded",async()=>{await fetchData();const fetchDataAndRender=subCategory=>async()=>{const data=await fetchData();if(data){const categoryLists=data.categories.filter(category=>category.subCategory===subCategory);let buttons;bottomSectionContainer.className="bottomSectionContainer",bottomSectionContainer.innerHTML="",document.querySelectorAll(".selection .buttonCards").forEach(button=>button.classList.remove("active")),document.getElementById(subCategory).classList.add("active"),productList.innerHTML="";let productCount=0;categoryLists.forEach(category=>{const buttonCard=document.createElement("div");buttonCard.className="buttonCards",[1,2].forEach(()=>{const paragraph=document.createElement("p");paragraph.textContent=category.faName,buttonCard.id=category.name,buttonCard.appendChild(paragraph)}),bottomSectionContainer.appendChild(buttonCard),productCount+=renderProducts(category.products),document.getElementById(category.name).addEventListener("click",()=>{fetchAndLogProducts(category.name),smoother.scrollTo(bottomSectionContainer,!0,"bottom top")})});const counter=document.querySelector(".counter");counter.textContent=`${productCount} محصول`}},renderProducts=products=>{let categoryProductCount=0;return products.forEach(product=>{const div=document.createElement("div");div.setAttribute("data-cursor","pointerLinkNavbar");const link=document.createElement("a");link.href=`${product.url}`;const img=document.createElement("img");img.src=`../assets/productImg/${product.image}`,img.alt=`${product.name.en} image, تصویر ${product.name.fa}`,img.setAttribute("loading","lazy"),link.appendChild(img),[product.name.en,product.name.fa].forEach(name=>{const p=document.createElement("p");p.className="englishText",p.textContent=name,link.appendChild(p)}),div.appendChild(link),productList.appendChild(div),categoryProductCount++}),activateCustomCursors(),categoryProductCount},fetchAndLogProducts=async categoryName=>{const data=await fetchData();if(data){let buttons;document.querySelectorAll(".selection .buttonCards").forEach(button=>button.classList.remove("active")),document.getElementById(categoryName).classList.add("active");const category=data.categories.find(cat=>cat.name===categoryName),counter=document.querySelector(".counter");counter.textContent=`${category.products.length} محصول`,category?(productList.innerHTML="",renderProducts(category.products)):console.log(`Category "${categoryName}" not found.`)}},resetData=()=>{bottomSectionContainer.className="",bottomSectionContainer.innerHTML=""};function getUrlParameter(name){const urlParams=new URLSearchParams(window.location.search);return urlParams.get(name)}document.getElementById("concreteAdditive").addEventListener("click",fetchDataAndRender("concreteAdditive")),document.getElementById("constructionChemicals").addEventListener("click",fetchDataAndRender("constructionChemicals")),document.getElementById("waterstop").addEventListener("click",fetchDataAndRender("waterstop")),document.getElementById("allProducts").addEventListener("click",()=>{renderAllProducts(),smoother.scrollTo(bottomSectionContainer,!0,"bottom top"),resetData()}),document.getElementById("plastic-spacers").addEventListener("click",()=>{fetchAndLogProducts("plastic-spacers"),smoother.scrollTo(bottomSectionContainer,!0,"bottom top"),resetData()}),document.getElementById("modern-building-facades").addEventListener("click",()=>{fetchAndLogProducts("modern-building-facades"),smoother.scrollTo(bottomSectionContainer,!0,"bottom top"),resetData()}),document.getElementById("raw-materials").addEventListener("click",()=>{fetchAndLogProducts("raw-materials"),smoother.scrollTo(bottomSectionContainer,!0,"bottom top"),resetData()}),await renderAllProducts();const productID=getUrlParameter("productID");productID&&setTimeout(()=>{const element=document.getElementById(productID);element&&element.click()},1e3)});