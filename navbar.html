<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>

    <script src="https://cdn.glitch.global/8352fc0e-bebe-4680-ae0b-269da8b54259/ScrollSmoother.min.js"></script>
    <script src="https://cdn.glitch.global/8352fc0e-bebe-4680-ae0b-269da8b54259/SplitText.min.js"></script>
    <script src="https://cdn.glitch.global/8352fc0e-bebe-4680-ae0b-269da8b54259/CSSRulePlugin.min.js?v=1701627202937"></script>
    <script async="" src="src/js/main.js"></script>

    <link rel="stylesheet" href="src/css/main.css" />
    <link rel="stylesheet" href="src/css/index.css" />
    <style>
      body {
        background: #f2ecdc;
      }
      nav {
        display: flex;
        font-family: "Montserrat", "Rokh";
        font-weight: 300;
        justify-content: center;
        padding: 3vmin 0;

        position: relative;
      }
      nav > div {
        background: hsla(39, 100%, 70%, 0.8);
        backdrop-filter: blur(0.5vmin);
        padding: 1vmin 5vmin;
        border-radius: 10vmin;
        z-index: 10;
        font-size: clamp(0.9rem, 1vw, 100rem);
      }
      nav > div:first-child {
        position: absolute;
        padding: 0;
        left: 3vmin;
        top: 50%;
        transform: translateY(-50%);
        margin: 0;
        width: 7vmin;
        height: 7vmin;
        display: flex;
        align-items: center;
        justify-content: center;

        background: #ffab2e;
      }
      nav > div:first-child img {
        object-fit: contain;
        width: 100%;
        height: 100%;
      }
      nav > div:nth-child(3) {
        border: 0vmin black solid;
      }
      nav .fleshDown {
        content: url(./assets/VectorFlesh5.svg);
        vertical-align: middle;
        height: 100%;
        width: 1.5vmin;
        min-width: 10px;
        margin: 0 1vmin;
      }
      nav .products {
        width: 100%;
        height: 80vmin;
        position: absolute;
        left: 0;
        top: 0;
        background: #fecb66;
        backdrop-filter: blur(0.5vmin);
        display: flex;
        font-size: clamp(0.8rem, 1vw, 100rem);
        overflow: hidden;
      }
      nav .products h5 {
        font-size: clamp(0.9rem, 1.2vw, 100rem);
      }
      nav .products > div {
        width: 25%;
        height: 100%;
        padding: 12vmin 2vmin;
      }
      nav .products > div div {
        padding: 3vmin 0;
      }
      nav .products a {
        text-decoration: none;
        color: black;

        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      }
      nav .products > div img {
        object-fit: cover;
        width: 100%;
        height: 80%;

        border: 0.1vmin black solid;

        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      nav .products div:first-child div {
        width: 100%;
        height: 80%;
        border: 0.1vmin black solid;
        font-weight: 600;

        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(1rem, 2vw, 100rem);
      }
      nav .products > a:nth-child(5),
      nav .products > a:nth-child(6),
      nav .products > a:nth-child(7) {
        display: none;
      }

      nav > div:last-of-type {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        display: none;
      }
      nav > div:last-of-type > span {
        display: block;
        width: 5vmax;
        border-bottom: 0.1vmin solid black;
        transition: all 0.3s ease;
      }
      nav > .hamburger > span:first-child {
        transform: rotate(0deg) translateY(-0.7vmin);
      }
      nav > .hamburger > span:last-child {
        transform: rotate(0deg) translateY(0.7vmin);
      }
      nav > .active > span:first-child {
        transform: rotate(15deg);
      }
      nav > .active > span:last-child {
        transform: rotate(-15deg);
      }
      @media only screen and (max-width: 768px) {
        nav {
          justify-content: right;
          padding: 5vmin 5vmin;
        }
        nav > div:not(:last-of-type) {
          display: none;
        }
        nav > div:last-of-type {
          display: block;
          padding: 4vmin 4vmax;
        }
        nav .products {
          width: 100%;
          height: 100vh;
          flex-direction: column;
        }
        nav .products > div {
          width: 100%;
          height: fit-content;
          padding: 0;
        }
        nav .products a {
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          padding: 2vmin 1vmin;
        }
        nav .products > div img {
          object-fit: cover;
          width: 30vmin;
          height: 30vmin;
          order: 1;
        }
        nav .products > a:nth-child(5),
        nav .products > a:nth-child(6),
        nav .products > a:nth-child(7) {
          display: block;
          border: 0.1vmin black solid;
          border-radius: 10vmin;
          justify-content: center;
          display: flex;
          justify-content: center;
          margin: 1vmin 1vmin;
        }
        nav .products > a:nth-child(5) {
          margin-top: auto;
        }

        nav .products > div:nth-child(2) {
          margin-top: auto;
        }
        nav .products > div:nth-child(3) {
          display: none;
        }
        nav .products > div div {
          padding: 3vmin 2vmin;
        }
        nav .products div:first-child div {
          display: none;
        }
      }
      @media only screen and (max-width: 470px) {
        nav .products > div:nth-child(3) {
          display: block;
        }
        nav .products > a:nth-child(5),
        nav .products > a:nth-child(6),
        nav .products > a:nth-child(7) {
          display: block;
          border: 0.1vmin black solid;
          border-radius: 10vmin;
          justify-content: center;
          display: flex;
          justify-content: center;
          margin: 2vmin 3vmin;
        }
        nav .products a {
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          padding: 3vmin 3vmin;
        }
        nav .products > a:nth-child(5) {
          margin-top: auto;
        }
        nav .products > div:nth-child(2) {
          margin-top: auto;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <div>
        <img src="assets/VectorLogo.svg" alt="" />
      </div>
      <div class="productsButton">
        <p>محصولات و خدمات<span class="fleshDown"></span></p>
      </div>
      <div><p>مقالات</p></div>
      <div><p>ارتباط با ما</p></div>
      <div class="hamburger">
        <span></span>
        <span></span>
      </div>
      <section class="products"></section>
    </nav>

    <script>
      gsap.registerPlugin(ScrollTrigger, ScrollSmoother, SplitText, TextPlugin);

      gsap.set("nav .products", { y: "0%" });

      var menu = gsap
        .timeline({ paused: true, reversed: true })
        .from("nav .products", { y: "-100%", duration: 1, ease: "power2.inOut" })
        .to(
          "nav > div:nth-child(3) > p",
          { text: "محصولات و خدمات", scale: "1.3", duration: 0.5, ease: "none" },
          0.5
        )
        .to("nav > div:nth-child(2) > p", { text: "", duration: 0.5, ease: "none" }, 0.5)
        .to(
          "nav > div:nth-child(2) ",
          {
            background: "hsla(39, 100%, 70%, 0)",
            duration: 0.5,
            ease: "none",
          },
          0.5
        )
        .to("nav > div:nth-child(4) > p", { text: "", duration: 0.5, ease: "none" }, 0.5)
        .to(
          "nav > div:nth-child(3)",
          { border: "0.1vmin black solid", duration: 0.5, ease: "none" },
          0.5
        )
        .to(
          "nav > div:nth-child(4)",
          {
            background: "hsla(39, 100%, 70%, 0)",
            duration: 0.5,
            ease: "none",
          },
          0.5
        );

      var buttonEnabledHamburger = true;

      document.querySelector(".hamburger").addEventListener("click", function () {
        if (buttonEnabled) {
          buttonEnabled = false;
          fetchDataForProducts();
          toggleMenu();
          toggleActiveClass();
        } else {
          toggleMenu();
          toggleActiveClass();

          buttonEnabled = true;
        }
      });

      function toggleActiveClass() {
        var hamburger = document.querySelector(".hamburger");
        hamburger.classList.toggle("active");
      }

      function toggleMenu() {
        menu.reversed() ? menu.timeScale(1).play() : menu.timeScale(2).reverse();
      }
      let buttonEnabled = true;

      document.querySelector("nav > div:nth-child(2)").addEventListener("click", function () {
        if (buttonEnabled) {
          buttonEnabled = false;
          fetchDataForProducts();
          toggleMenu();
        }
      });

      document.querySelector("nav > div:nth-child(3)").addEventListener("click", function () {
        if (!buttonEnabled) {
          toggleMenu();
          buttonEnabled = true;
        }
      });

      document.body.addEventListener("click", function (event) {
        if (!buttonEnabled && !event.target.closest("nav")) {
          buttonEnabled = true;
          toggleMenu();
        }
      });

      function fetchDataForProducts() {
        fetch("products/products.json")
          .then((response) => response.json())
          .then((data) => {
            const selectedProducts = [];

            data.categories.forEach((category) => {
              const randomProducts = getRandomItems(category.products, 1);
              selectedProducts.push(...randomProducts);
            });

            const randomSelectedProducts = getRandomItems(selectedProducts, 3);

            document.querySelector("nav .products").innerHTML = "";

            addSection(randomSelectedProducts);
          })
          .catch((error) => console.error("Error fetching data:", error));
      }

      function addSection(products) {
        const otherProductContent = document.querySelector("nav .products");

        const outerDiv = document.createElement("div");
        const link = document.createElement("a");
        const innerDiv = document.createElement("div");
        const paragraph = document.createElement("p");

        link.setAttribute("href", "#");
        paragraph.textContent = "همه‌ی محصولات";

        innerDiv.appendChild(paragraph);
        link.appendChild(innerDiv);
        outerDiv.appendChild(link);

        otherProductContent.appendChild(outerDiv);

        products.forEach((product) => {
          const otherProductItem = document.createElement("div");

          const productInfo = document.createElement("div");

          const titleFa = document.createElement("h5");
          titleFa.textContent = product.name.fa;

          const titleEn = document.createElement("span");
          titleEn.classList.add("englishText");
          titleEn.textContent = product.name.en;

          productInfo.appendChild(titleEn);
          productInfo.appendChild(titleFa);

          const image = document.createElement("img");
          image.src = `../assets/productImg/${product.image}`;
          image.alt = `${product.image} Image`;

          const LinkContainer = document.createElement("a");
          LinkContainer.href = product.url;

          LinkContainer.appendChild(image);
          LinkContainer.appendChild(productInfo);
          otherProductItem.appendChild(LinkContainer);

          otherProductContent.appendChild(otherProductItem);
        });

        var links = [
          { text: "لیست همه‌ی محصولات", href: "wqdwqd" },
          { text: "مقالات", href: "dqwdwq" },
          { text: "ارتباط با ما", href: "dqwqwdqdw" },
        ];

        for (var i = 0; i < links.length; i++) {
          var newLink = document.createElement("a");
          newLink.textContent = links[i].text;
          newLink.setAttribute("href", links[i].href);

          var newDiv = document.createElement("div");
          newDiv.appendChild(newLink);

          otherProductContent.appendChild(newLink);
        }
      }

      function getRandomItems(array, count) {
        const shuffled = array.sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      }
    </script>
  </body>
</html>
